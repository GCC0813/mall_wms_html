<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>商品审核</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../css/goods.css">
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>商品审核</legend>
</fieldset>
<div class="to-examine">
    <div class="layui-form-item">
        <label class="layui-form-label">商品名</label>
        <div class="layui-input-block">
            <input type="text" readonly id="goods-name" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">商品主图</label>
        <div class="layui-input-block" id="layer-photos">
            <table><tr id="pic-img">
            </tr></table>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline " >
            <label class="layui-form-label">商品详情图</label>
            <div class="layui-input-inline" id="layer-photos-detail" >
                <table><tr id="detail-pic-img">
                </tr></table>
            </div>
        </div>
    </div>

    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">商品简介</label>
        <div class="layui-input-block">
            <textarea readonly class="layui-textarea" id="goods-synopsis"></textarea>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">商品分类</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-category">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">商品标签</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-tag">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">市场参考价</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="market-price">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">采购价</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="purchase-price">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">实物或虚拟</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="physical-or-virtual">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">供应商</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-supplier">
            </div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">商品状态</label>
        <div class="layui-input-block" id="status-checkBox">
            <button type="button" id="goods-status" class="layui-btn  layui-btn-radius"></button>
            <button type="button" id="good-check-status" class="layui-btn layui-btn-normal layui-btn-radius layui-btn-disabled"></button>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">审核人</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-toExamine-people">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">审核时间</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-toExamine-time">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">创建人</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-founder">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">创建时间</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-founder-time">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">修改人</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-modifier">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">修改时间</label>
            <div class="layui-input-inline">
                <input type="text" readonly class="layui-input" id="goods-modify-time">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" id="confirmation-audit" >确认审核</button>
        </div>
    </div>
</div>
<script src="../../lib/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="../../comm/jquery.js"></script>
<script type="text/javascript" src="../../comm/comm.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use('layer', function(){
        let loadIndex=layer.load(2);
        let goodsId = window.sessionStorage.getItem("ID");
        $(function () {
            initialization(goodsId);
        });

        $("#confirmation-audit").click(function () {
            layer.confirm("确认要审核成功，成功将不可取消！",function () {
                let o={
                    goodsId: goodsId,
                    type : 2,
                    status: 1
                };
                $.post(domain+'/goods/set-goods-status',objToJson(o),function (res) {
                    if(res.code===200){
                        layer.msg("确认审核成功！",{icon:6,offset:25},function () {
                            initialization(goodsId);
                        });
                    }else {
                        layer.msg(res.msg)
                    }
                });
            })
        });

        function initialization(goodsId){
            let jsonReq={
                goodsId : goodsId
            };
            $.post(domain+'/goods/details',objToJson(jsonReq),function (res) {
                if(res){
                    layer.close(loadIndex);
                }
                if(res.code ===200){
                    let data =res.data;
                    $('#goods-name').attr('placeholder',data.name);
                    $("#pic-img img").remove()
                    $.each(data.picUrls, function (index, pic) {
                        $("#pic-img").append('<td><img class="layui-upload-img" src="'+pic+'" style="height: 100px"></td>');
                    });
                    layer.photos({
                        photos: '#pic-img'
                        ,anim: 0
                    });
                    $("#detail-pic-img img").remove()
                    $.each(data.detailPicUrls, function (index, pic) {
                        $("#detail-pic-img").append('<td><img class="layui-upload-img" src="'+pic+'" style="height: 100px"></td>');
                    });
                    layer.photos({
                        photos: '#detail-pic-img'
                        ,anim: 0
                    });
                    $('#goods-synopsis').attr('placeholder',data.synopsis);
                    $('#goods-category').attr('placeholder',data.categoryName);
                    $('#goods-tag').attr('placeholder',data.tagName);
                    $('#physical-or-virtual').attr('placeholder',data.physicalOrVirtual);
                    $('#market-price').attr('placeholder','￥'+data.marketPrice);
                    $('#purchase-price').attr('placeholder','￥'+data.purchasePrice);
                    $('#goods-supplier').attr('placeholder',data.supplier);
                    let goodsStatus = $('#goods-status');
                    if(data.status===2){
                        goodsStatus.addClass("layui-btn-disabled");
                    }
                    goodsStatus.text(data.statusStr);
                    let goodsCheckStatus = $('#good-check-status');
                    if(data.checkStatus===1){
                        goodsCheckStatus.removeClass("layui-btn-disabled")
                        $("#confirmation-audit").remove();
                    }
                    goodsCheckStatus.text(data.checkStatusStr);

                    $('#goods-toExamine-people').attr('placeholder',data.toExamine);
                    $('#goods-toExamine-time').attr('placeholder',data.toExamineTime);
                    $('#goods-founder').attr('placeholder',data.founder);
                    $('#goods-founder-time').attr('placeholder',data.createTime);
                    $('#goods-modifier').attr('placeholder',data.modifier);
                    $('#goods-modify-time').attr('placeholder',data.modificationTime);
                }else {
                    layer.msg(res.msg)
                }
            });
        }
    });
</script>

</body>
</html>