<!DOCTYPE html>
<html class="x-admin-sm">

<head>
    <meta charset="UTF-8">
    <title>商品分类添加</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="../../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/admin.js"></script>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>订单发货</legend>
</fieldset>
<div class="layui-fluid layui-anim layui-anim-scale">
    <div class="layui-row">
        <form class="layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label">订单编号</label>
                <div class="layui-input-inline">
                    <input type="text" readonly class="layui-input" id="order-no">
                </div>
                <a class="layui-btn" id="order-detail" title="查看订单详情"><i class="layui-icon layui-icon-spread-left"></i> </a>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>物流单号
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="delivery_no" name="delivery_no" required="" lay-verify="required" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>物流公司
                </label>
                <div class="layui-input-inline">
                    <select name="campany" lay-search="" id="campany" >
                        <option value="0">请选择物流公司</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                    <span class="x-red">*</span>物流运费
                </label>
                <div class="layui-input-inline">
                    <input type="text" id="delivery_fee" name="delivery_fee" required="" lay-verify="required" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">
                </label>
                <button  class="layui-btn" lay-filter="add" lay-submit="">
                    确认发货
                </button>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript" src="../../comm/jquery.js"></script>
<script type="text/javascript" src="../../comm/comm.js"></script>
<script>
    let orderId = window.sessionStorage.getItem("ID");
    layui.use(['form', 'layer'], function() {
        $ = layui.jquery;
        let form = layui.form,
            layer = layui.layer;

        $(function () {
            let obj = {
                orderId: orderId
            };
            let loadIndex = layer.load(2);
            $.post(domain + '/order/details', objToJson(obj), function (res) {
                if (res) {
                    layer.close(loadIndex);
                }
                if (res.code === 200) {
                    $("#order-no").attr("placeholder", res.data.orderNo)
                    $.post(domain + '/order/logistics-company', function (res) {
                        if (res.code === 200) {
                            $.each(res.data.list, function (index, com) {
                                $("#campany").append('<option value="' + com.id + '">' + com.name + '</option>');
                            });
                            form.render('select');
                        } else {
                            layer.msg(res.msg)
                        }
                    });
                } else if (res.code === 102) {
                    layer.msg(res.msg, {icon: 5, offset: '20px'}, function () {
                        top.location = '../login.html'
                    })
                } else {
                    layer.msg(res.msg)
                }
            });
        });

        //监听提交
        /*form.on('submit(add)', function(data) {
            let company = data.field.campany;
            if(parseInt(company)===0){
                layer.msg("请选择物流公司！")
                    return false;
            }
            company = $("#campany option:selected").text();
            let delivery_no = data.field.delivery_no;
            if (delivery_no.length>30){
                layer.msg("物流单号不能超过30个字符！");
                return false;
            }
            let delivery_fee = data.field.delivery_fee;

            let obj = {
                orderId : orderId,
                deliveryNo : delivery_no,
                deliveryCompany:company,
                deliveryFee:delivery_fee
            };
            let loadIndex = layer.load(2);
            $.post(domain + '/order/to-deliver', objToJson(obj), function (res) {
                if(res){
                    layer.close(loadIndex);
                }
                if(res.code === 200){
                    layer.msg("发货成功！",{icon: 1},function(){
                        xadmin.close();
                    })
                }else if(res.code===102){
                    layer.msg(res.msg,{icon:5,offset: '20px'},function () {
                        top.location='../login.html'
                    })
                }else {
                    layer.msg(res.msg)
                }
            });
            return false;
        });*/

    });
</script>
</body>

</html>
